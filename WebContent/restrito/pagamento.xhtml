<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pi="http://primefaces.org/ui">

<h:head>

	<title>Cloud Sistem</title>

	<link rel="stylesheet" href="../foundation/css/foundation.css" />
	<script src="../foundation/js/vendor/modernizr.js"></script>

	<link type="text/css" rel="stylesheet" href="../css/menu.css" />
	<link type="text/css" rel="stylesheet" href="../css/componentes.css" />
	<link type="text/css" rel="stylesheet" href="../css/pagamento.css" />

	<script type="text/javascript" src="../js/componentes.js" />
	<script type="text/javascript" src="../js/numeric.js" />


</h:head>

<h:body>



	<ui:include src="componentes/menu.xhtml" />
	<script>
		ativarMenuBotoes("pagamento");
	</script>

	<div class="content">

		<ul class="tabs" data-tab="tabs">
			<li class="tab-title active"><a href="#aRealizar">Realizar
					Pagamentos</a></li>
			<li class="tab-title"><a href="#historico">Histórico de
					Pagamentos</a></li>
		</ul>
		<div class="tabs-content" id="tabs">
			<div class="content active" id="aRealizar">
				<div class="container" align="center">
					<div class="subtabela">

						<pi:growl id="growl" life="6000" />
						<pi:focus for="formPag:nomeCliente" />


						<h:form id="formPag" prependId="false">

							<pi:remoteCommand name="enterkey"
								actionListener="#{pagamentoBean.modificarListaAtualDeVendasPeloCliente}"
								update="formPag:info" />


							<pi:autoComplete id="nomeCliente" styleClass="campo grade left"
								value="#{pagamentoBean.nomeClienteParaVenda}"
								completeMethod="#{pagamentoBean.completNomeCliente}"
								title="Nome do cliente" placeholder="Nome do Cliente"
								update="formPag:info"
								onkeypress="if(event.keyCode == 13){enterkey();return false;}"
								onchange="enterkey();">

								<f:ajax event="keyup"
									listener="#{pagamentoBean.modificarListaAtualDeVendasPeloCliente}"
									render=":tableVed :info" />


							</pi:autoComplete>


							<h:panelGroup id="info">
								<div class="info">

									<div class="debito" align="left">
										<h:outputLabel id="saldoInfo" value="Débito:   "
											rendered="#{pagamentoBean.clienteSelecionado != null}">
											<h:outputLabel
												rendered="#{pagamentoBean.clienteSelecionado != null}"
												value="#{pagamentoBean.clienteSelecionado.debito}"
												converter="valueConverter" />
										</h:outputLabel>
									</div>

									<div class="valor" align="left">
										<h:panelGroup
											rendered="#{pagamentoBean.clienteSelecionado != null and pagamentoBean.clienteSelecionado.debito > 0}"
											columns="2" columnClasses="large-1">
											<h:outputLabel id="valueLabel" value="Valor a ser Pago:  "
												for="valorPagamentoInput" />
											<h:inputText id="valorPagamentoInput"
												styleClass="campo_medio money"
												value="#{pagamentoBean.newPagamento.valor}" immediate="true"
												converter="valueConverter">
												<f:ajax event="keyup" execute="@this" />
												<f:ajax event="change" execute=":troco" render=":troco"
													immediate="true" />
											</h:inputText>

											<pi:commandLink value="Add Obs"
												title="Adicionar observações sobre o pagamento"
												onclick="abrirModa('modalObservacao');"
												rendered="#{pagamentoBean.clienteSelecionado != null and pagamentoBean.clienteSelecionado.debito > 0}"
												update="@form">
											</pi:commandLink>

											<h:commandButton id="pagar" styleClass="bt-cadastrar"
												rendered="#{pagamentoBean.clienteSelecionado != null and pagamentoBean.clienteSelecionado.debito > 0}"
												value="Pagar" title="Registrar o pagamento"
												actionListener="#{pagamentoBean.cadastrarPagamento()}"
												update="@all" />

										</h:panelGroup>
									</div>

									<pi:outputLabel id="troco"
										rendered="#{pagamentoBean.newPagamento.valor > pagamentoBean.clienteSelecionado.debito}"
										value="Troco: ">
										<h:outputLabel
											value="#{pagamentoBean.newPagamento.valor - pagamentoBean.clienteSelecionado.debito}"
											converter="valueConverter" />
									</pi:outputLabel>


								</div>

							</h:panelGroup>



							<h:dataTable id="tableVed" styleClass="tabela"
								value="#{pagamentoBean.listAtualDeVenda}" var="venda">
								<f:facet name="header">
									<h4 align="center">Vendas não pagas</h4>
								</f:facet>
								<h:column headerClass="large-2">
									<f:facet name="header">Data</f:facet>
									<h:outputLabel value="#{venda.dia.time}">
										<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"
											timeZone="GMT-03:00" />
									</h:outputLabel>
								</h:column>
								<h:column headerClass="large-3">
									<f:facet name="header">Cliente</f:facet> 
																#{venda.cliente.nome}
								</h:column>
								<h:column headerClass="large-1">
									<f:facet name="header">Valor da Venda</f:facet>
									<h:outputLabel value="#{venda.totalComDesconto}"
										converter="valueConverter" />
								</h:column>
								<h:column headerClass="large-1">
									<f:facet name="header">Valor Restante</f:facet>
									<h:outputLabel value="#{venda.valorNaoPagoDaVenda}"
										converter="valueConverter" />
								</h:column>
								<h:column headerClass="large-1">
									<f:facet name="header">Pagar</f:facet>
									<h:selectBooleanCheckbox
										value="#{pagamentoBean.checked[venda.id]}">
										<f:ajax event="click" execute="@form"
											listener="#{pagamentoBean.vendaSelecionada}" />
									</h:selectBooleanCheckbox>

								</h:column>
							</h:dataTable>

						</h:form>

						<!-- modal -->

						<div id="modalObservacao" class="reveal-modal modal_complementar"
							data-reveal="modalObservacao">

							<h4>Observações sobre o pagamento</h4>
							<br />
							<pi:focus for="formObs:textareaOBS" context="formObs" />

							<h:form prependId="false" id="formObs">

								<div class="formulario">

									<div class="row">
										<pi:inputTextarea id="textareaOBS" rows="4"
											value="#{pagamentoBean.newPagamento.observacao}"
											immediate="true" styleClass="left"
											placeholder="Observações sobre o pagamento"
											title="Observações sobre o pagamento">
											<pi:ajax update="@this" immediate="true" />
										</pi:inputTextarea>
									</div>

									<div class="row">
										<h:commandButton value="Salvar"
											onclick="fecharModal('modalObservacao')"
											styleClass="bt-cadastrar" />
										<h:commandButton value="Cancelar" styleClass="bt-cadastrar"
											actionListener="#{pagamentoBean.limparObsPagamento()}" />
									</div>
								</div>
							</h:form>

							<a class="close-reveal-modal">&#215;</a>
						</div>
						<!-- fim modal -->







					</div>
				</div>
			</div>





			<!-- Tab historico -->
			<div class="content" id="historico">

				<div class="container" align="center">
					<div class="subtabela">




						<h:form id="formHist" prependId="false">

							<pi:autoComplete id="completCliente"
								placeholder="Nome do Cliente"
								completeMethod="#{pagamentoBean.completNomeClienteHistorico}"
								value="#{pagamentoBean.nomeClienteParaHistorico}"
								styleClass="campo grade left">
								<f:ajax event="keyup"
									listener="#{pagamentoBean.modificarListaAtualDeHistoricoDoCliente}"
									render=":tableHist" />
							</pi:autoComplete>

						</h:form>

						<h:dataTable id="tableHist" styleClass="tabela"
							value="#{pagamentoBean.listAtualDeHistoricos}" var="pagamento">
							<f:facet name="header">
								<h4 align="center">Histórico de Pagamentos</h4>
							</f:facet>

							<h:column headerClass="large-1">
								<f:facet name="header">Valor</f:facet>
								<h:outputLabel value="#{pagamento.valor}"
									converter="valueConverter" />
							</h:column>

							<h:column headerClass="large-2">
								<f:facet name="header">Cliente</f:facet>
								<h:outputLabel value="#{pagamento.cliente.nome}" />
							</h:column>


							<h:column headerClass="large-1">
								<f:facet name="header">Data</f:facet>
								<h:outputLabel value="#{pagamento.data.time}">
									<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"
										timeZone="GMT-03:00" />
								</h:outputLabel>
							</h:column>

							<h:column headerClass="large-1">
								<f:facet name="header">Funcionário</f:facet>
																#{pagamento.funcionario.nome}
															</h:column>

							<h:column headerClass="large-2">
								<f:facet name="header">Observações</f:facet>
								<h:outputLabel rendered="#{not empty pagamento.observacao}"
									value="#{pagamento.observacao}" />
							</h:column>
						</h:dataTable>

					</div>
				</div>

			</div>
			<!-- fim div historico -->


		</div>



	</div>

	<script src="../foundation/js/foundation.min.js"></script>
	<script type="text/javascript">
		$(document).foundation();
		jQuery(function($) {
			$("#valorPagamentoInput").numeric({
				decimal : ",",
				negative : false,
				scale : 2
			});
		});
	</script>

</h:body>


</html>